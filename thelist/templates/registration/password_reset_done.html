{% extends 'whattodo/base.html' %}

{% block title %}Password reset done{% endblock %}

{% block content %}
<head>
    <style>
        /* Critical CSS - Loaded first to prevent flash */
        html, body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%) !important;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        /* Hide content until fully loaded */
        .page-content {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        
        .page-loaded .page-content {
            opacity: 1;
        }
    </style>
    <style>
        /* Critical CSS - Loaded first to prevent flash */
        html, body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%) !important;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        /* Hide content until fully loaded */
        .page-content {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        
        .page-loaded .page-content {
            opacity: 1;
        }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Reset Email Sent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'slide-up': 'slideUp 0.4s ease-out',
                        'slide-down': 'slideDown 0.4s ease-out',
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'pulse-glow': 'pulseGlow 2s infinite',
                        'bounce-gentle': 'bounceGentle 1.5s infinite',
                        'check-bounce': 'checkBounce 0.6s ease-out',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.3); }
            50% { box-shadow: 0 0 40px rgba(34, 197, 94, 0.6); }
        }
        @keyframes bounceGentle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        @keyframes checkBounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .gradient-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .btn-primary {
            background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        /* Email icon animation */
        .email-icon {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* Success checkmark animation */
        .success-check {
            animation: checkBounce 0.6s ease-out 0.3s both;
        }

        /* Mobile optimizations */
        @media (max-width: 640px) {
            .container-padding {
                padding: 1rem;
            }
        }
    </style>
</head>

<body class="min-h-screen gradient-bg font-sans overflow-x-hidden">
    <div class="min-h-screen flex items-center justify-center container-padding">
        <div class="w-full max-w-md mx-auto">
            <!-- Main Content Card -->
            <div class="glass-effect rounded-3xl p-8 sm:p-10 text-center animate-slide-up">
                <!-- Success Icon -->
                <div class="mb-8">
                    <div class="relative mx-auto w-24 h-24 sm:w-28 sm:h-28">
                        <!-- Background Circle -->
                        <div class="w-full h-full bg-gradient-to-br from-teal-400 to-teal-600 rounded-full flex items-center justify-center animate-pulse-glow">
                            <!-- Email Icon -->
                            <svg class="w-12 h-12 sm:w-14 sm:h-14 text-white email-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                            </svg>
                        </div>
                        <!-- Success Checkmark -->
                        <div class="absolute -bottom-2 -right-2 w-8 h-8 sm:w-10 sm:h-10 bg-white rounded-full flex items-center justify-center success-check shadow-lg">
                            <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Header -->
                <div class="mb-8 animate-slide-down" style="animation-delay: 0.2s; opacity: 0; animation-fill-mode: forwards;">
                    <h1 class="text-2xl sm:text-3xl font-bold text-white mb-3">
                        Check Your Email
                    </h1>
                    <p class="text-white text-base sm:text-lg leading-relaxed">
                        We've sent password reset instructions to your email address
                    </p>
                </div>

                <!-- Content -->
                <div class="space-y-6 mb-8 animate-fade-in" style="animation-delay: 0.4s; opacity: 0; animation-fill-mode: forwards;">
                    <!-- Success Message -->
                    <div class="glass-effect bg-teal-500/20 border border-teal-400/30 rounded-xl p-6">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0">
                                <svg class="w-6 h-6 text-teal-300 animate-bounce-gentle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                            <div class="text-left">
                                <h3 class="text-white font-semibold mb-2">Email Sent Successfully</h3>
                                <p class="text-white text-sm leading-relaxed">
                                    Check your inbox and follow the link in the email to reset your password.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Instructions -->
                    <div class="text-left space-y-4">
                        <h3 class="text-white font-semibold text-lg">Next Steps:</h3>
                        <div class="space-y-3">
                            <div class="flex items-start gap-3">
                                <div class="flex-shrink-0 w-6 h-6 bg-teal-500 rounded-full flex items-center justify-center text-white text-xs font-bold">1</div>
                                <p class="text-white text-sm">Check your email inbox (and spam folder)</p>
                            </div>
                            <div class="flex items-start gap-3">
                                <div class="flex-shrink-0 w-6 h-6 bg-teal-500 rounded-full flex items-center justify-center text-white text-xs font-bold">2</div>
                                <p class="text-white text-sm">Click the password reset link in the email</p>
                            </div>
                            <div class="flex items-start gap-3">
                                <div class="flex-shrink-0 w-6 h-6 bg-teal-500 rounded-full flex items-center justify-center text-white text-xs font-bold">3</div>
                                <p class="text-white text-sm">Create your new password</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="space-y-4 animate-slide-up" style="animation-delay: 0.6s; opacity: 0; animation-fill-mode: forwards;">
                    <a href="{% url 'whattodo:login' %}" 
                       class="btn-primary w-full py-4 px-6 rounded-xl text-white font-semibold text-lg inline-block hover:scale-105 transform transition-all duration-200">
                        <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"/>
                        </svg>
                        Back to Login
                    </a>
                    
                    <button onclick="openEmailClient()" 
                            class="btn-secondary w-full py-4 px-6 rounded-xl text-white font-semibold text-lg hover:scale-105 transform transition-all duration-200">
                        <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                        Open Email App
                    </button>
                </div>
            </div>

            <!-- Help Section -->
            <div class="mt-8 text-center animate-fade-in" style="animation-delay: 0.8s; opacity: 0; animation-fill-mode: forwards;">
                <div class="glass-effect rounded-2xl p-6">
                    <h3 class="text-white font-semibold mb-3">Didn't receive the email?</h3>
                    <div class="space-y-3 text-sm text-white">
                        <p>• Check your spam or junk folder</p>
                        <p>• Make sure the email address is correct</p>
                        <p>• Wait a few minutes for delivery</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Toast Container for notifications -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // Function to open default email client
        function openEmailClient() {
            // Try to open default email client
            try {
                window.location.href = 'mailto:';
            } catch (e) {
                // Fallback: show popular email providers
                showEmailProviders();
            }
        }

        // Function to show email provider options
        function showEmailProviders() {
            const providers = [
                { name: 'Gmail', url: 'https://mail.google.com' },
                { name: 'Outlook', url: 'https://outlook.live.com' },
                { name: 'Yahoo Mail', url: 'https://mail.yahoo.com' },
                { name: 'Apple Mail', url: 'https://www.icloud.com/mail' }
            ];

            const providerLinks = providers.map(provider => 
                `<a href="${provider.url}" target="_blank" rel="noopener" class="block w-full text-left px-4 py-2 text-green-100 hover:bg-white/10 rounded-lg transition-colors">${provider.name}</a>`
            ).join('');

            showToast(`
                <div class="text-left">
                    <p class="font-semibold mb-2">Choose your email provider:</p>
                    <div class="space-y-1">
                        ${providerLinks}
                    </div>
                </div>
            `, 'info', 8000);
        }

        // Function to request new password reset email
        function requestNewEmail() {
            const resendBtn = document.getElementById('resendBtn');
            const originalText = resendBtn.innerHTML;
            
            // Show loading state
            resendBtn.innerHTML = `
                <svg class="animate-spin w-4 h-4 inline mr-1" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Sending...
            `;
            resendBtn.disabled = true;

            // Simulate API call (replace with actual endpoint)
            setTimeout(() => {
                resendBtn.innerHTML = originalText;
                resendBtn.disabled = false;
                showToast('Password reset email sent again! Check your inbox.', 'success');
            }, 2000);
        }

        // Toast notification system
        function showToast(message, type = 'info', duration = 5000) {
            const container = document.getElementById('toast-container');
            if (!container) return;

            const toast = createToast(message, type);
            container.appendChild(toast);

            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full', 'opacity-0');
            }, 10);

            // Auto remove
            setTimeout(() => {
                removeToast(toast);
            }, duration);
        }

        function createToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `transform translate-x-full opacity-0 transition-all duration-300 max-w-sm`;
            
            const colors = {
                success: 'bg-green-500/90 border-green-400/50',
                error: 'bg-red-500/90 border-red-400/50',
                warning: 'bg-yellow-500/90 border-yellow-400/50',
                info: 'bg-blue-500/90 border-blue-400/50'
            };

            const icons = {
                success: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>',
                error: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>',
                warning: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01"/></svg>',
                info: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'
            };

            toast.innerHTML = `
                <div class="glass-effect ${colors[type]} border rounded-xl p-4 shadow-lg backdrop-blur-sm">
                    <div class="flex items-start gap-3">
                        <div class="flex-shrink-0 text-white">
                            ${icons[type]}
                        </div>
                        <div class="flex-1 text-white text-sm">
                            ${message}
                        </div>
                        <button onclick="removeToast(this.closest('.transform'))" class="text-white/70 hover:text-white transition-colors flex-shrink-0">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `;

            return toast;
        }

        function removeToast(toast) {
            toast.classList.add('translate-x-full', 'opacity-0');
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 300);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Add subtle entrance animations
            const elements = document.querySelectorAll('[style*="animation-delay"]');
            elements.forEach((el, index) => {
                setTimeout(() => {
                    el.style.opacity = '1';
                }, index * 200);
            });

            // Auto-focus functionality for better UX
            setTimeout(() => {
                const backButton = document.querySelector('a[href*="login"]');
                if (backButton) {
                    backButton.focus();
                }
            }, 1000);

            console.log('Password reset page initialized');
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Enter key to go back to login
            if (e.key === 'Enter') {
                const loginLink = document.querySelector('a[href*="login"]');
                if (loginLink) {
                    window.location.href = loginLink.href;
                }
            }
            
            // 'E' key to open email
            if (e.key === 'e' || e.key === 'E') {
                openEmailClient();
            }
        });
    </script>
</body>
{% endblock %}